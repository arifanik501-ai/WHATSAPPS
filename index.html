<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WhatsApp Clone</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Setup SVGs -->
    <svg style="display:none;">
        <symbol id="icon-sync" viewBox="0 0 24 24">
            <path
                d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" />
        </symbol>
        <symbol id="icon-back" viewBox="0 0 24 24">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
        </symbol>
        <symbol id="icon-person" viewBox="0 0 24 24">
            <path
                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
        </symbol>
        <symbol id="icon-videocam" viewBox="0 0 24 24">
            <path
                d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" />
        </symbol>
        <symbol id="icon-call" viewBox="0 0 24 24">
            <path
                d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
        </symbol>
        <symbol id="icon-more" viewBox="0 0 24 24">
            <path
                d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
        </symbol>
        <symbol id="icon-emoji" viewBox="0 0 24 24">
            <path
                d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 1.5 8.5 1.5zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
        </symbol>
        <symbol id="icon-attach" viewBox="0 0 24 24">
            <path
                d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-3.31-2.69-6-6-6S3 1.69 3 5v12.5c0 3.31 2.69 6 6 6s6-2.69 6-6V6h-1.5z" />
        </symbol>
        <symbol id="icon-camera" viewBox="0 0 24 24">
            <path
                d="M19 8C19 6.9 18.1 6 17 6H13.62C13.2 5 12.19 4 11 4C9.81 4 8.8 5 8.38 6H5C3.9 6 3 6.9 3 8V18C3 19.1 3.9 20 5 20H19C20.1 20 21 19.1 21 18V8H19ZM12 18C9.24 18 7 15.76 7 13C7 10.24 9.24 8 12 8C14.76 8 17 10.24 17 13C17 15.76 14.76 18 12 18ZM12 10C10.34 10 9 11.34 9 13C9 14.66 10.34 16 12 16C13.66 16 15 14.66 15 13C15 11.34 13.66 10 12 10Z" />
        </symbol>
        <symbol id="icon-mic" viewBox="0 0 24 24">
            <path
                d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
        </symbol>
        <symbol id="icon-send" viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
        </symbol>
        <symbol id="icon-down" viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
        </symbol>
        <symbol id="icon-close" viewBox="0 0 24 24">
            <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
        </symbol>
        <symbol id="tick-single" viewBox="0 0 16 11">
            <path d="M14.5 1.5l-8 8-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
        </symbol>
        <symbol id="tick-double" viewBox="0 0 22 11">
            <path d="M15.5 1.5l-8 8-4-4 M20.5 1.5l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
        </symbol>
    </svg>

    <div id="app">
        <!-- Landing Page -->
        <div id="landing-page">
            <div class="wa-logo-container">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51a12.8 12.8 0 00-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                </svg>
            </div>
            <div class="landing-title">Who do you want to chat as?</div>
            <button class="user-btn" onclick="selectUser('user1')">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="white">
                    <use href="#icon-person" />
                </svg>
                User 1 (Me)
            </button>
            <button class="user-btn user2-btn" onclick="selectUser('user2')">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="white">
                    <use href="#icon-person" />
                </svg>
                User 2 (Me)
            </button>
            <div class="landing-note">Select one on this device, the other on a second device</div>
        </div>

        <!-- Chat Page -->
        <div id="chat-page">
            <div id="conn-banner"></div>
            <header>
                <div class="header-left" onclick="showLanding()">
                    <div class="back-btn"><svg>
                            <use href="#icon-back" />
                        </svg></div>
                    <div class="avatar"><svg>
                            <use href="#icon-person" />
                        </svg></div>
                    <div class="user-info">
                        <span class="user-name" id="chat-partner-name">...</span>
                        <span class="user-status" id="chat-partner-status">Waiting...</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-icon" onclick="showToast('Coming soon')"><svg>
                            <use href="#icon-videocam" />
                        </svg></div>
                    <div class="header-icon" onclick="showToast('Coming soon')"><svg>
                            <use href="#icon-call" />
                        </svg></div>
                    <div class="header-icon" id="sync-icon" onclick="manualSync()" style="display:none;"><svg>
                            <use href="#icon-sync" />
                        </svg></div>
                    <div class="header-icon" onclick="toggleMenu(event)"><svg>
                            <use href="#icon-more" />
                        </svg></div>
                </div>
                <!-- 3-dots Dropdown -->
                <div class="dropdown" id="main-menu">
                    <div class="dropdown-item" onclick="promptClearChat()">Clear chat</div>
                    <div class="dropdown-item" onclick="promptWallpaper()">Wallpaper</div>
                    <div class="dropdown-item" onclick="showLanding()">Change User</div>
                    <div class="dropdown-item" id="auto-sync-btn" onclick="toggleAutoSync()">Auto Sync: OFF</div>
                    <div class="dropdown-item" id="manual-sync-btn" onclick="manualSync()">Manual Sync</div>
                </div>
            </header>

            <div id="chat-body" onscroll="handleScroll()">
                <div class="encryption-banner">
                    🔒 Messages are end-to-end encrypted. No one outside of this chat can read or listen to them.
                </div>
                <!-- Messages go here dynamically -->

                <div class="typing-bubble" id="typing-indicator">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>

            <div id="scroll-bottom" onclick="scrollToBottom()">
                <svg>
                    <use href="#icon-down" />
                </svg>
                <div class="unread-count" id="unread-badge">0</div>
            </div>

            <!-- Context Menu (hidden) -->
            <div id="context-menu">
                <div class="dropdown-item" onclick="handleReply()">Reply</div>
                <div class="dropdown-item" onclick="handleCopy()">Copy</div>
                <div class="dropdown-item" onclick="handleDeletePrompt()">Delete</div>
            </div>

            <!-- Reply Preview Bar -->
            <div id="reply-preview">
                <div class="reply-content">
                    <div class="reply-sender-name" id="reply-name"></div>
                    <div class="reply-text-preview" id="reply-text"></div>
                </div>
                <div class="close-reply" onclick="cancelReply()">
                    <svg>
                        <use href="#icon-close" />
                    </svg>
                </div>
            </div>

            <footer>
                <div class="input-wrapper">
                    <button class="icon-btn" onclick="toggleEmojiPanel()"><svg>
                            <use href="#icon-emoji" />
                        </svg></button>
                    <textarea id="msg-input" rows="1" placeholder="Type a message" oninput="handleInput()"></textarea>
                    <div class="action-container">
                        <button class="icon-btn" onclick="showToast('Coming soon')"><svg>
                                <use href="#icon-attach" />
                            </svg></button>
                        <button class="icon-btn" id="camera-btn" onclick="showToast('Coming soon')"><svg>
                                <use href="#icon-camera" />
                            </svg></button>
                    </div>
                </div>
                <button class="send-btn" id="send-btn" onclick="sendMessage()">
                    <svg id="send-icon">
                        <use href="#icon-mic" />
                    </svg>
                </button>
            </footer>

            <!-- Emoji Panel -->
            <div id="emoji-panel">
                <div class="emoji-categories">
                    <div class="emoji-cat active-cat" onclick="loadEmojis('smileys')">ðŸ˜Š</div>
                    <div class="emoji-cat" onclick="loadEmojis('animals')">ðŸ¾</div>
                    <div class="emoji-cat" onclick="loadEmojis('food')">ðŸ”</div>
                    <div class="emoji-cat" onclick="loadEmojis('sports')">âš½</div>
                    <div class="emoji-cat" onclick="loadEmojis('travel')">ðŸš—</div>
                    <div class="emoji-cat" onclick="loadEmojis('objects')">ðŸ’¡</div>
                    <div class="emoji-cat" onclick="loadEmojis('symbols')">â¤ï¸</div>
                </div>
                <div class="emoji-grid" id="emoji-grid">
                    <!-- Emojis populated by JS -->
                </div>
            </div>
        </div>

        <!-- Toast & Overlays -->
        <div id="toast"></div>

        <!-- Dialog Overlay -->
        <div class="overlay" id="dialog-overlay" onclick="closeDialog(event)">
            <div class="dialog" id="dialog-box" onclick="event.stopPropagation()">
                <div class="dialog-title" id="dialog-title">Title</div>
                <div id="dialog-body">Content</div>
                <div class="dialog-actions" id="dialog-actions">
                    <button class="dialog-btn" onclick="closeDialog()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Base64 placeholder -->
    <audio id="notif-sound" preload="auto">
        <!-- Short pop sound base64 -->
    </audio>

    <script src="app.js"></script>
</body>

</html>